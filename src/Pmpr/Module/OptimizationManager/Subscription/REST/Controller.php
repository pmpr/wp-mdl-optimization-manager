<?php
/*   _______________________________________
    |  Obfuscated by PMPR - Php Obfuscator  |
    |             68cc7218d5152             |
    |_______________________________________|
*/
 namespace Pmpr\Module\OptimizationManager\Subscription\REST; use Pmpr\Common\Foundation\Interfaces\Constants; use Pmpr\Module\DomainManager\Model\Domain; use Pmpr\Module\OptimizationManager\REST\Controller as BaseClass; use Pmpr\Module\OptimizationManager\Subscription\Model\Extra; use Pmpr\Module\OptimizationManager\Subscription\Model\Plan; use Pmpr\Module\OptimizationManager\Subscription\Model\Subscription; use Pmpr\Module\OptimizationManager\Subscription\Setting; use Pmpr\Module\OptimizationManager\Setting as ModuleSetting; use Pmpr\Module\OptimizationManager\Subscription\Traits\EngineTrait; use WP_Error; use WP_HTTP_Response; use WP_REST_Request; use WP_REST_Response; class Controller extends BaseClass { use EngineTrait; const oquukmukaoqegcuk = 'usage_ids'; public function ikcgmcycisiccyuc() { parent::ikcgmcycisiccyuc(); $this->rest_base .= '/subscription'; } public function register_routes() { $this->register('/add-usage', [Constants::wwgusigoaksqmwsm => [$this, 'skkysuqqysioiwwg'], Constants::oaggieeykyaoiiyw => self::qucyckeykeuuaquw, Constants::okeuagwgwkmiokac => [Constants::myikkigscysoykgy => [Constants::squoamkioomemiyi => 'array', Constants::eqkeooqcsscoggia => __('Actions', PR__MDL__OPTIMIZATION_MANAGER)], Constants::sygmkaeayiiouiwm => [Constants::squoamkioomemiyi => 'string', Constants::eqkeooqcsscoggia => __('Token', PR__MDL__OPTIMIZATION_MANAGER)]]]); $this->register('/change-usages-status', [Constants::wwgusigoaksqmwsm => [$this, 'amkoumqiwyaqukow'], Constants::oaggieeykyaoiiyw => self::ouuaeeeqeqkagcgi, Constants::okeuagwgwkmiokac => [self::oquukmukaoqegcuk => [Constants::squoamkioomemiyi => 'array', Constants::eqkeooqcsscoggia => __('Usage IDs', PR__MDL__OPTIMIZATION_MANAGER)], Constants::ciywsqoeiymemsys => [Constants::squoamkioomemiyi => 'string', Constants::eqkeooqcsscoggia => __('Usages Status', PR__MDL__OPTIMIZATION_MANAGER)], Constants::sygmkaeayiiouiwm => [Constants::squoamkioomemiyi => 'string', Constants::eqkeooqcsscoggia => __('Token', PR__MDL__OPTIMIZATION_MANAGER)]]]); $this->register('/get-purchases', [Constants::wwgusigoaksqmwsm => [$this, 'ksykuaykyyuqgswg'], Constants::okeuagwgwkmiokac => [Constants::imywcsggckkcywgk => [Constants::squoamkioomemiyi => 'string', Constants::eqkeooqcsscoggia => __('Page', PR__MDL__OPTIMIZATION_MANAGER)]]]); $this->register('/get-data', [Constants::wwgusigoaksqmwsm => [$this, 'seyyiqmgwymyumoq']]); } public function seyyiqmgwymyumoq(WP_REST_Request $aqmwamyiwgeeymqa) { $gwgucoaaqcwwciqq = $this->ogkysoamaegikmcy($aqmwamyiwgeeymqa); $esuksqieigiqcaie = $this->aemeowyaecqmymas($aqmwamyiwgeeymqa, Constants::aciemiuuwgysykom); if ($esuksqieigiqcaie && $gwgucoaaqcwwciqq) { $qwgquweoiskugckg = 0; $umwagewoweuckiso = null; $swgwkyqkakceqeia = Domain::symcgieuakksimmu(); $mokawwccycoiqeka = $swgwkyqkakceqeia->aqiwcawmimkygoau($esuksqieigiqcaie, $gwgucoaaqcwwciqq); $goqqimcssiyagkwy = $this->uykissogmuaaocsg(); if ($mokawwccycoiqeka && !is_wp_error($mokawwccycoiqeka)) { $wqykqusigegasqeg = $swgwkyqkakceqeia->mwyqswsaeeewsosm($mokawwccycoiqeka); $umwagewoweuckiso = $goqqimcssiyagkwy->mkiwiwaquqeegaik($wqykqusigegasqeg); if (!$umwagewoweuckiso) { $ekucuuaawysekyca = $goqqimcssiyagkwy->mkiwiwaquqeegaik($wqykqusigegasqeg, false); if (!$ekucuuaawysekyca) { $akqaumomesyiuiym = $goqqimcssiyagkwy->imicysmecoiycoqc(); if ($akqaumomesyiuiym) { $sogksuscggsicmac = $goqqimcssiyagkwy->subscribe($wqykqusigegasqeg, $akqaumomesyiuiym); if ($sogksuscggsicmac && !is_wp_error($sogksuscggsicmac)) { $umwagewoweuckiso = $sogksuscggsicmac; } } } } $qwgquweoiskugckg = $goqqimcssiyagkwy->xowkiecqumsskiec($wqykqusigegasqeg); } $omouioamescuegke = Plan::symcgieuakksimmu(); $omcwcsgeyeyoiwyi = Subscription::symcgieuakksimmu(); $kekgkgqeyesmkywu = $omouioamescuegke->qyaiiayimwmuomey(false); $qsqwqsymmqeoqwcu = []; $gkyciwoiiisgywcs = $this->caokeucsksukesyo()->ywqgcuymeiswqyqc(); foreach ($kekgkgqeyesmkywu as $gesuaewsacmmwoeo) { $ogaeiucyqmowuqms = $omouioamescuegke->mwyqswsaeeewsosm($gesuaewsacmmwoeo); $oggygmyiawqsyecy = $goqqimcssiyagkwy->gsmygqkksqsseoeq(); if ($oggygmyiawqsyecy) { $oggygmyiawqsyecy = $this->uwkmaywceaaaigwo()->owicscwgeuqcqaig()->yqymaqmqiqmmmsoo(['step' => 4, 'target' => $ogaeiucyqmowuqms, 'order_type' => Constants::uswkskaqiieoyacg], $oggygmyiawqsyecy); } $gmcgeogogyqsgawk = $omouioamescuegke->asosocqswygacyyk($gesuaewsacmmwoeo); $gmcgeogogyqsgawk = [Constants::uomuwqaqggoekwwg => $gkyciwoiiisgywcs->get($gmcgeogogyqsgawk, Constants::uomuwqaqggoekwwg, false), Constants::mykiyeswieqamagm => $gkyciwoiiisgywcs->get($gmcgeogogyqsgawk, Constants::mykiyeswieqamagm), Constants::qescuiwgsyuikume => $gkyciwoiiisgywcs->get($gmcgeogogyqsgawk, Constants::quumookoiuysuyuw), Constants::owimkwkiwawmeicq => $gkyciwoiiisgywcs->get($gmcgeogogyqsgawk, Constants::owimkwkiwawmeicq), Constants::eeeyoywyquqywwoo => $gkyciwoiiisgywcs->get($gmcgeogogyqsgawk, Constants::eeeyoywyquqywwoo), Constants::iuqumwggccmcuyem => $gkyciwoiiisgywcs->get($gmcgeogogyqsgawk, Constants::iuqumwggccmcuyem), Constants::qscwcyiaqccoayqk => $gkyciwoiiisgywcs->get($gmcgeogogyqsgawk, Constants::qscwcyiaqccoayqk), Constants::ueasagmikqewqcay => $gkyciwoiiisgywcs->get($gmcgeogogyqsgawk, Constants::ueasagmikqewqcay, 0), Constants::iysgkeueasmuwmcq => $oggygmyiawqsyecy, Constants::quywusioaoakumaw => $gkyciwoiiisgywcs->get($gmcgeogogyqsgawk, Constants::quywusioaoakumaw), Plan::kceiayeyisgquuim => $gkyciwoiiisgywcs->get($gmcgeogogyqsgawk, Plan::kceiayeyisgquuim, 0), Plan::cgiaykosmmoyuagu => $gkyciwoiiisgywcs->get($gmcgeogogyqsgawk, Plan::cgiaykosmmoyuagu, 0)]; $qsqwqsymmqeoqwcu[$ogaeiucyqmowuqms] = $gmcgeogogyqsgawk; if ((int) $ogaeiucyqmowuqms === (int) $omcwcsgeyeyoiwyi->waecsyqmwascmqoa($umwagewoweuckiso, Constants::kiwgokskimawckie)) { $umwagewoweuckiso[Constants::qescuiwgsyuikume] = $gmcgeogogyqsgawk[Constants::qescuiwgsyuikume]; } } $keccaugmemegoimu = $this->qasywwyamoesisyi('', ['coins' => $qwgquweoiskugckg, 'plans' => $qsqwqsymmqeoqwcu, 'remote_apps' => ModuleSetting::symcgieuakksimmu()->kykwaemmssqsguqw(), 'extra_coins' => $goqqimcssiyagkwy->ycmmosmyyiycyeug(true), 'subscription' => $umwagewoweuckiso]); } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->cackyykusuowuiwg(); } return $this->ewmkmmsuiuwmmwoy($keccaugmemegoimu); } public function ksykuaykyyuqgswg(WP_REST_Request $aqmwamyiwgeeymqa) { $gwgucoaaqcwwciqq = $this->ogkysoamaegikmcy($aqmwamyiwgeeymqa); $esuksqieigiqcaie = $this->aemeowyaecqmymas($aqmwamyiwgeeymqa, Constants::aciemiuuwgysykom); if ($esuksqieigiqcaie && $gwgucoaaqcwwciqq) { $swgwkyqkakceqeia = Domain::symcgieuakksimmu(); $mokawwccycoiqeka = $swgwkyqkakceqeia->aqiwcawmimkygoau($esuksqieigiqcaie, $gwgucoaaqcwwciqq); if (!is_wp_error($mokawwccycoiqeka)) { if ($mokawwccycoiqeka) { $suaemuyiacqyugsm = $this->aemeowyaecqmymas($aqmwamyiwgeeymqa, Constants::imywcsggckkcywgk, 1); $wqykqusigegasqeg = $swgwkyqkakceqeia->mwyqswsaeeewsosm($mokawwccycoiqeka); $keccaugmemegoimu = $this->qasywwyamoesisyi(__('Your Request is valid.', PR__MDL__OPTIMIZATION_MANAGER), ['extras' => $this->kiyymmqeuqucwggg(Extra::symcgieuakksimmu(), $wqykqusigegasqeg, $suaemuyiacqyugsm), 'subscriptions' => $this->kiyymmqeuqucwggg(Subscription::symcgieuakksimmu(), $wqykqusigegasqeg, $suaemuyiacqyugsm)]); } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('Can not detect your domain. please contact us.', PR__MDL__OPTIMIZATION_MANAGER)); } } else { $keccaugmemegoimu = $mokawwccycoiqeka; } } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->cackyykusuowuiwg(); } return $this->ewmkmmsuiuwmmwoy($keccaugmemegoimu); } public function amkoumqiwyaqukow(WP_REST_Request $aqmwamyiwgeeymqa) { $mgegoogckgsumooq = $this->aemeowyaecqmymas($aqmwamyiwgeeymqa, Constants::sygmkaeayiiouiwm); $iueymcwwscwqkiyq = $this->aemeowyaecqmymas($aqmwamyiwgeeymqa, Constants::ciywsqoeiymemsys); $yayiceymsscqcsoy = $this->aemeowyaecqmymas($aqmwamyiwgeeymqa, self::oquukmukaoqegcuk); if ($mgegoogckgsumooq && $yayiceymsscqcsoy && is_array($yayiceymsscqcsoy) && $iueymcwwscwqkiyq && in_array($iueymcwwscwqkiyq, [Constants::amcogigwsaqssuai, Constants::uasuowkaguiwoouw], true)) { if ($this->ycocqiwisouieuig($mgegoogckgsumooq)) { foreach ($yayiceymsscqcsoy as $wwcmeousycqgqwws) { $this->uykissogmuaaocsg()->ysqwckqmysqyuuow($wwcmeousycqgqwws, $iueymcwwscwqkiyq); } $keccaugmemegoimu = $this->qasywwyamoesisyi(__('Usages statuses changed successfully.', PR__MDL__OPTIMIZATION_MANAGER)); } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('Your request is not valid and requested route does not exists.', PR__MDL__OPTIMIZATION_MANAGER), 400); } } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->cackyykusuowuiwg(); } return $this->ewmkmmsuiuwmmwoy($keccaugmemegoimu); } public function skkysuqqysioiwwg(WP_REST_Request $aqmwamyiwgeeymqa) { $mgegoogckgsumooq = $this->aemeowyaecqmymas($aqmwamyiwgeeymqa, Constants::sygmkaeayiiouiwm); $esuksqieigiqcaie = $this->aemeowyaecqmymas($aqmwamyiwgeeymqa, Constants::aciemiuuwgysykom); $aiamqeawckcsuaou = $this->aemeowyaecqmymas($aqmwamyiwgeeymqa, Constants::uqgcmmosieyimiku); if ($mgegoogckgsumooq && $esuksqieigiqcaie && $aiamqeawckcsuaou) { if ($this->ycocqiwisouieuig($mgegoogckgsumooq)) { $swgwkyqkakceqeia = Domain::symcgieuakksimmu(); $mokawwccycoiqeka = $swgwkyqkakceqeia->aqiwcawmimkygoau($esuksqieigiqcaie); if ($mokawwccycoiqeka && !is_wp_error($mokawwccycoiqeka)) { $goqqimcssiyagkwy = $this->uykissogmuaaocsg(); $wqykqusigegasqeg = $swgwkyqkakceqeia->mwyqswsaeeewsosm($mokawwccycoiqeka); $umwagewoweuckiso = $goqqimcssiyagkwy->mkiwiwaquqeegaik($wqykqusigegasqeg); if ($umwagewoweuckiso) { $smowyuyseuwiaiei = $goqqimcssiyagkwy->kymquygyagwwqwkm($wqykqusigegasqeg, $aiamqeawckcsuaou); if ($smowyuyseuwiaiei > 0) { if ($yayiceymsscqcsoy = $goqqimcssiyagkwy->iimacqcwqcucqcwo($wqykqusigegasqeg, $smowyuyseuwiaiei, Constants::sgoswgskyiiwkyuo)) { $keccaugmemegoimu = $this->qasywwyamoesisyi(__('Usages added successfully.', PR__MDL__OPTIMIZATION_MANAGER), [Constants::sqcsaeqsycmuiiso => $smowyuyseuwiaiei, self::oquukmukaoqegcuk => $yayiceymsscqcsoy]); } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('Can not add usage for requested domain.', PR__MDL__OPTIMIZATION_MANAGER), 403); } } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('Can not calculate your requested actions coin amount.', PR__MDL__OPTIMIZATION_MANAGER), 400); } } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('Seems the domain has no valid subscription.', PR__MDL__OPTIMIZATION_MANAGER), 400); } } else { $keccaugmemegoimu = $mokawwccycoiqeka; } } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('Your request is not valid and requested route does not exists.', PR__MDL__OPTIMIZATION_MANAGER), 400); } } else { $keccaugmemegoimu = $this->caokeucsksukesyo()->euekiyuksecoccus()->cackyykusuowuiwg(); } return $this->ewmkmmsuiuwmmwoy($keccaugmemegoimu); } private function kiyymmqeuqucwggg($meywaqqsugaoeyys, $wqykqusigegasqeg, $suaemuyiacqyugsm) : array { $geeyaumoyycymeks = $meywaqqsugaoeyys instanceof Subscription; $omouioamescuegke = Plan::symcgieuakksimmu(); $ykquycoiqesuckco = Setting::symcgieuakksimmu(); $aqauykcugwiqkumq = $this->caokeucsksukesyo()->mmmcswscsiecscwg(); $umkkkaqkwugkemce = 0; if (!$geeyaumoyycymeks) { $umkkkaqkwugkemce = $ykquycoiqesuckco->giiuwsmyumqwwiyq(Setting::ysogiyumowssousm, 0); } $ymiyawysimukkoso = $meywaqqsugaoeyys->iekyeyicoyyawomk()->aeggeuqycwawueqy($meywaqqsugaoeyys->iekyeyicoyyawomk()->yassqyiieqeywoqi(Constants::kuqwimiimiqsimgo, $wqykqusigegasqeg), [Constants::imywcsggckkcywgk => $suaemuyiacqyugsm, Constants::wosqwewmqmyweqea => false]); $cyymykkuugqaugia = []; $cgceoyqmmwumqyqa = $this->uwkmaywceaaaigwo()->wikusamwomuogoau(); foreach ($ymiyawysimukkoso[Constants::qwumqqyuasyskkkc] as $igqsaukqcqscimok) { $icwicymcioeyeyek = []; $igqsaukqcqscimok = (array) $igqsaukqcqscimok; if ($geeyaumoyycymeks) { $zkoismskyqiakggu = (array) $omouioamescuegke->iekyeyicoyyawomk()->akkkoiiymmamsauc($igqsaukqcqscimok[Constants::kiwgokskimawckie] ?? 0); if ($zkoismskyqiakggu) { $umkkkaqkwugkemce = $zkoismskyqiakggu[Constants::uecoocasykucckuu] ?? 0; } $icwicymcioeyeyek['plan'] = $omouioamescuegke->uikgwcuascgeissw($zkoismskyqiakggu); $icwicymcioeyeyek[Constants::icymuyeowqaciyyu] = $meywaqqsugaoeyys->waecsyqmwascmqoa($igqsaukqcqscimok, Constants::icymuyeowqaciyyu); } else { $cosmgoaiwuamyesi = $meywaqqsugaoeyys->waecsyqmwascmqoa($igqsaukqcqscimok, Constants::ciyoccqkiamemcmm, 0); if ($cosmgoaiwuamyesi > 0) { $icwicymcioeyeyek[Constants::ciyoccqkiamemcmm] = $cosmgoaiwuamyesi; } } $aumscagymwyyicag = 0; if ($umkkkaqkwugkemce && ($gkkgcoiwayaccqgm = $meywaqqsugaoeyys->waecsyqmwascmqoa($igqsaukqcqscimok, Constants::awkcoioakcaougmq))) { $mgwmckosekeimqms = $this->caokeucsksukesyo()->mmmcswscsiecscwg()->wasgwsogmuquqeaa($gkkgcoiwayaccqgm); foreach ($mgwmckosekeimqms as $cawesmkieccckaae) { if ($umkkkaqkwugkemce === $aqauykcugwiqkumq->scwwywwaeuumakiq($cawesmkieccckaae)) { $aumscagymwyyicag = $cawesmkieccckaae->get_total(); } } } $cyymykkuugqaugia[] = [Constants::gouqcwikiiygyasc => $meywaqqsugaoeyys->mwyqswsaeeewsosm($igqsaukqcqscimok), Constants::kumuoysauoagaiiy => $meywaqqsugaoeyys->waecsyqmwascmqoa($igqsaukqcqscimok, Constants::CREATED_AT), Constants::uiwqcumqkgikqyue => $icwicymcioeyeyek, Constants::acymsykymkiewqsy => $cgceoyqmmwumqyqa->aumscagymwyyicag($aumscagymwyyicag)]; } return [Constants::qwumqqyuasyskkkc => $cyymykkuugqaugia, Constants::ycuusiweasqygwiw => $ymiyawysimukkoso[Constants::ycuusiweasqygwiw]]; } private function ycocqiwisouieuig($mgegoogckgsumooq) : bool { $qcaiykuysiowsimu = ModuleSetting::symcgieuakksimmu()->giiuwsmyumqwwiyq(ModuleSetting::yemcsuieyckgsyek, [], [Constants::kyyscqqmsikeuaea => Constants::sygmkaeayiiouiwm, Constants::aisguagukaewucii => Constants::ckmqoekmugkggeym, Constants::wosqwewmqmyweqea => $mgegoogckgsumooq]); return !empty($qcaiykuysiowsimu); } }
